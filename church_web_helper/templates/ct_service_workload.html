<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html" lang="en">
{% include 'header.html' %}

<body>
    {% include 'error.html' %}
    {% include 'navbar.html' %}
    <div class="container">
        <form action="{{ url_for('ct_service_workload') }}" method="POST">
            <h2>Kalender</h2>
            <select class="form-select" multiple aria-label="multiple select" name="selected_calendars">
                {% for calendar_id, calendar_name in available_calendars.items() %}
                <option {% if calendar_id in selected_calendars %} selected{% endif %} value="{{calendar_id}}">
                    {{calendar_name}}</option>
                {% endfor %}
            </select>
            <h2>Dienste</h2>
            <select class="form-select" multiple aria-label="multiple select" size="15" name="selected_service_types">
                {% for service_category_id, available_service_types in available_service_types_by_category.items() %}

                <optgroup label="{{available_service_categories[service_category_id]}}">

                    {% for service_type in available_service_types %}
                    <option {% if service_type['id'] in selected_service_types %} selected{% endif %}
                        value="{{service_type['id']}}">
                        {{service_type['name']}}</option>
                    {% endfor %}

                </optgroup>
                {% endfor %}
                <h2>Namen</h2>
                <ul>
                    {% for name in names %}
                    <li>{{ name }}</li>
                    {% endfor %}
                </ul>

                <h2>Angewendete Filter</h2>

                <table class="table">
                    <tr>
                        <th>Was</th>
                        <th>Wie</th>
                    </tr>
                    <tr>
                        <td>Von</td>
                        <td>
                            <input type="date" id="date" class="form-control" name="from_date"
                                value="{{ from_date.strftime('%Y-%m-%d') }}">
                        </td>
                    </tr>
                    <tr>
                        <td>Bis</td>
                        <td>
                            <input type="date" id="date" class="form-control" name="to_date"
                                value="{{ to_date.strftime('%Y-%m-%d') }}">
                        </td>
                    </tr>
                    <tr>
                        <td>Min Dienste</td>
                        <td>
                            <input type="number" id="number" class="form-control" name="min_services_count"
                                value="{{ min_services_count }}">
                        </td>
                    </tr>
                    <tr>
                        <td>Excluded Patterns</td>
                        <td>
                            <input type="text" id="text" class="form-control form-text" name="exclude_patterns"
                                value="{{ exclude_patterns }}">
                            <div id="exclude_patterns_help" class="form-text">enter a list of regex strings e.g.
                                ['.*immer.*',['.*dacht.*'']</div>
                        </td>
                    </tr>
                </table>
                <button type="submit" class="btn btn-primary">Auswahl anpassen</button>
        </form>
        {% if plots %}<h2>Diagramme</h2>{%endif%}
        {% for plot in plots %}
        <div>
            <img src="data:image/png;base64,{{ plot }}">
        </div>
        <hr>
        {% endfor %}

        {% if event_names %}<h2>Ber√ºcksichtigte Veranstaltungen</h2>{%endif%}
        <div>
            {% for eventname, occurancecount in event_names.items() %}
            <div>{{eventname}} : {{occurancecount}}</div>
            {% endfor %}
        </div>
    </div>
</body>

</html>